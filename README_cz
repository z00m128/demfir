DTP's EMulator FIles Runner
===========================

Verze pro divIDE


Fièury:
- V¹e se odhrává v NMI menu.
- Vlastní detekce IDE zaøízení.
- Práce s iso9660 (CD-ROM image) pøímo z CD-ROM mechaniky, pøípadnì nahraný
  na ZIP drive, HDD nebo CompactFlash. Pokud image není nahrán od zaèátku média,
  není automaticky detekován a musí být pou¾ita funkce "hledání".
- Funkce automatického hledání ISO image. Zaèátek image je nalezen postupným
  naèítáním média, ale ka¾dá sranda nìco stojí, tak ho nenahrávejte moc
  "daleko", jinak se vá¾nì naèekáte.
- Mo¾nost procházet celý strom adresáøù a souborù (integrovaný browser).
- Hledání souborù v adresáøi podle jména
- V¹e se pamatuje (naètený adresáø, pozice v nìm, data o TAPce atd.).
- Detekce typu souborù; obrázky podle délky, emulátorové soubory podle pøípony.
- Prohlí¾ení barevných (6912 B) a èernobílých (6144 B) obrázkù s detekcí barvy
  borderu.
- Spou¹tìní snapù SNA (48K i 128K).
- Spou¹tìní snapù Z80 (verze 1.x, 2.x a 3.x).
- Spou¹tìní snapù MFC (48K i 128K).
- Tape emulátor pro TAP soubory (read only = save není podporováno). Pøi
  zvolení TAPky v browseru je zobrazen obsah jako "virtuální" adresáø a je
  mo¾no nastavit load kurzor. Pokud program ète data pomocí ROM, jsou pøi
  vybrané TAPce ètena z IDE zaøízení, pokud ¾ádná TAPka vybraná není, ète se
  pøímo z MGF (pomocí standardních rutin ROM).
- Tape emulátor pro TZX soubory, viz. TAP. Brány v úvahu jsou pouze bloky
  s ID=10h. Ostatní jsou zobrazeny v browseru, ale pøi ètení z pásky jsou
  pøeskoèeny.
- Ètení POK souborù a snadné zapínání a vypínání jednotlivých cheatù (cheat je
  skupina POKE aplikovaných naráz).
- Modulární struktura - nìkteré èásti je pøi kompilaci mo¾no vypnout a udìlat
  si tak místo pro nìjaké jiné :).

Ovládání NMI menu (klávesy jsou zvýraznìny):
D = device  - zmìna zaøízení (master/slave).
M = medium  - znovunaètení média a nové hledání image.
R = reset   - softwarový reset (JP 0), spoleènì se 'SYMBOL SHIFT' vyma¾e i RAM
              DEMFIRu.
I = init    - nová detekce zaøízení, spoleènì se 'SYMBOL SHIFT' pro LBA i CHS
              disky ignoruje zji¹tìnou velikost zaøízení a nastaví max. hodnoty
              (128 GB pro LBA a cca 8 GB pro CHS). Pro CHS disky navíc vezme
              výchozí geometrii místo aktuální (mù¾e pomoci s nìkterými starými
              nebo nestandardními disky).
              Pokud je pøelo¾eno s WITH_WDC a disk vykazuje neplatnou aktuální
              geometrii (nìkteré Western Digital), disku je nastavena výchozí
              geometrie a místo jména zaøízení se objeví "CHS translation:" a
              tøi èísla oddìlené lomítky znaèící nastavenou geometrii. Poté JE
              NUTNO provést detekci ZNOVU. V pøípadì, ¾e dal¹í detekce dopadne
              stejnì (opìt "CHS translation:" atd.), vá¹ disk není ochoten si
              novou geometrii zapamatovat a pak je tøeba provést detekci
              spoleènì se sti¹tìným 'SYMBOL SHIFT'. To zamezí nastavování
              geometrie a disk bude pou¾it tak jak je.
Q = quit    - opu¹tìní NMI menu, pøepne na zvolenou VRAM (viz. klávesa 'V')
F = find    - nalezení ISO image kdekoli na médiu (nelze spustit na reálné
              CD-ROM). Hledání pokraèeje od aktuální pozice + velikost
              souèasného iso image (pokud je nìjaký nalezen) + offset Primary
              Volume Descriptoru (16 dvoukilových sektorù). Pokud chcete hledat
              od aktuální pozice, stisnìte klávesu 'F' spoleènì s 'SYMBOL SHIFT'
              Hledání lze pøeru¹it stiskem 'SPACE'.
S = sector  - umo¾òuje zadat èíslo sektoru, odkud se bude èíst ISO image,
              pøípadnì od toho sektoru hledat. Ovládání inputu viz. "Ovládání
              inputu" :). Èíslo je v ¹estnáctkové soustavì, akceptuje znaky
              0-9 a A-F (nezále¾í na velikosti písmen). Po ukonèení vstupu se
              èíslo sektoru pou¾ije jako ofset pro naètení ISO image (pokud se
              objeví 'No ISO image found', zkuste hledání.
V = VRAM    - zobrazí aktuální Video RAM (po stisku NMI je to v¾dy 1.),
              opakovaným stiskem klávesy 'V' lze pøepínat mezi 1. a 2. VRAM.
              Pokud bìhem zobrazování není 'V' sti¹tìno do dvou vteøin od
              poslední zmìny, aktuálnì zobrazená VRAM je nastavena pro Quit a
              DEMFIR se vrátí do NMI menu. Ve 48K re¾imu pouze zobrazí 1. VRAM,
              pøepínání není mo¾né.
P = paging  - zaká¾e 128K stránkování (out 32765,48), pouze hw reset ho povolí.
C = cheat   - (pouze pokud je pøelo¾eno s PokeManagerem) zobrazí seznam a stav
              aktuálních cheatù (naètených z .POK souboru), pokud ¾ádné
              aktuální cheaty nejsou, okam¾itì pøejde na ruèní vstup POKE (lze
              zru¹it kombinací CS+1).
Enter       - vstup do browseru

Ovládání browseru:
¹ipka nahoru - posun na pøede¹lý soubor
¹ipka dolù   - posun na dal¹í soubor
¹ipka vlevo  - skok na zaèátek stránky, pokud je ji¾ kurzor na první polo¾ce,
               skok na pøede¹lou stránku
¹ipka vpravo - skok na konec stránky, pokud je ji¾ kurzor na poslední polo¾ce,
               skok na následující stránku
Enter        - akce = zobrazení obrázku (èeká na klávesu), spu¹tìní snapu,
               procházení TAPky èi adresáøe (zále¾í na okolnostech)
Enter+SS     - pøi aktivní TAPce nastaví load kurzor
Mezerník     - ukonèení browseru
Ostatní klávesy jsou pou¾ity pro hledaní souboru dle jména. Hledá se podle
ASCII s ohledem na velikost písmen - case sensitive (vzhledem k organizaci
iso9660 nelze jinak). Na zaèátek adresáøe se dostanete hledáním teèky, na konec
"rourou" (SS+S). Speccyální znaky (napø. èísla pod kurzory) lze zadat pøes
"mrtvou klávesu" TRUE VIDEO (CS+3), jejím stiskem se zmìní border na modrý a
dal¹í klávesa se pou¾ije pøímo na hledání, nikoliv v jejim pùvodním významu.
Je nalezen první odpovídající soubor ve smìru hledání, pokud není nalezena
pøesná shoda, kurzor se posune na nejbli¾¹í následující.
Hledání je ukonèeno speccyální klávesou (napø. pohybem kurzoru).

Ovládání inputu:
CS+1 (EDIT)  - ukonèí vstup bez ulo¾ení hodnoty
CS+2 (CAPSL) - vyma¾e v¹echny zadané znaky
CS+4 (INV.V) - vlo¾í mezeru za kurzor
CS+5 ( <- )  - posune kurzor vlevo
CS+6 ( ^ )   - pøemístí kurzor na zaèátek øádku
CS+7 ( v )   - pøemístí kurzor na konec øádku
CS+8 ( -> )  - posune kurzor vpravo
CS+9 (GRAPH) - sma¾e znak napravo od kurzoru (delete)
CS+0 (DEL)   - sma¾e znak nalevo od kurzoru (backspace)
Enter        - ukonèí vstup s ulo¾ením hodnoty
Zadávání znakù je v re¾imu "pøepis" (starý znak je nahrazen novì zadaným), pro
vlo¾ení znakù pøed existující øetìzec pou¾ijte CS+4. Pokud jsou vlo¾eny
nepøípustné znaky, pøi ukonèení vstupu je kurzor postaven ZA problematický
znak. Pokud je zadané èíslo mimo povolený rozsah je kurzor postaven na jeho
konec.

Pøi práci v TAPce je kurzor buï zelený (v¹e ok), èervený (TAPka obsahuje
nìjakou chybu) nebo ¾lutý (TAPka je OK, ale obsahuje moc souborù a nebyl
poøízen jejich seznam => není mo¾né s nimi pracovat). Pøi práci s TZX je to
stejné, navíc pøibyl je¹tì purpurový kurzor znaèící pøítomnost bloku, který
pravdìpodobnì zpùsobí nefunkènost celého TZX souboru.

Pokud pøi LOADu z TAP/TZX dojede kurzor konec souboru, je TAP/TZX automaticky
"pøevinut" na zaèátek. Pozici load kurzoru lze kdykoliv zjistit/zmìnit pøes
browser.

V NMI menu je v úplnì prvním øádku zobrazeno (zleva doprava):
- stav pøeru¹ení (IM1/IM2, EI/DI)
- aktuální re¾im (48K/128K)
- aktivní 128K stránka
- zvolená VRAM (nelze detekovat)

V druhém øádku je seznam podporovaných formátù
- Z80 = snapy Z80 v¹ech verzí, povoluje WITH_Z80 v config.a80 
- SNA = snapy SNA, povoluje WITH_SNA v config.a80
- MFC = snapy MFC, povoluje WITH_MFC v config.a80
- SCR = prohlí¾eè obrázkù, povoluje WITH_SCR v config.a80
- POK = PokeManager, povoluje WITH_POK v config.a80

Ve tøetím øádku jsou ostatní moduly a nastavení
- CHS = podpora pro HDD bez LBA, povoluje WITH_CHS v config.a80
- WDC = automatické nastavování geometrie pøi detekci zaøízení, vy¾adují
        nìkteré disky Western Caviar, povoluje WITH_WDC v config.a80
- +3R = stránkuje ROM +2A/+3 na portu 8189, povoluje ROM_2A_3 v config.a80
- MTF = podpora pro nìkteré TZX bloky, které obsahují dal¹í data nepotøebná pro
        emulaci pásky, povoluje WITH_MTF v config.a80

Logo lze zmìnit pomocí USELOGO (rozsah 0-3, viz. config.a80).
Komu se nezdá originální zx font, povolením BOLD_FONT v config.a80 si mù¾e
zapnout tuèný font z Didaktiku M.

PokeManager
- Ovládání shodné s ovládáním browseru, navíc má následující klávesy:
  A = add    - pøidá POKE (ruèní vstup).
  D = delete - sma¾e POKE nebo cheat který je POSLEDNÍ na seznamu.
  C = clear  - sma¾e ve¹keré cheaty a automaticky pøejde na ruèní zadání POKE.
- Pro jednotlivé cheaty zobrazuje jejich název a v pøípadì, ¾e se jedná
  o stavový cheat tak i YES pro aktivní a NO pro neaktivní. Pokud se jedná
  o cheat vy¾adující hodnotu, zobrazuje aktuální stav pamìti.
- Barva kurzoru má následující význam:
  Zelená  - je známa pùvodní hodnota v pamìti a pamì» buï obsahuje ji nebo
            hodnotu z cheatu, je bezpeèné cheat zapínat i vypínat.
  ®lutá   - pùvodní hodnota není známa a nebylo tak mo¾no provést ovìøení,
            pokud jste si jisti, ¾e je naètený správný POK soubor, mìlo by
            být bezpeèné cheat zapnout, s vypnutím by mohly být problémy.
  Èervená - je známa pùvodní hodnota v pamìti, ale pamì» neobsahuje ji ani
            hodnotu z cheatu, je NEBEZPEÈNÉ tento cheat zapínat nebo vypínat
            a pravdìpodobnì to povede k po¹kození spu¹tìné hry/aplikace.
- Pøi zadávání èísla pro cheat vy¾adující hodnotu fungují standardní klávesy
  (viz. Ovládání inputu). Nabízena je PÙVODNÍ hodnota (nikoliv aktuální a
  zobrazený stav pamìti). Prostým odentrováním je tak mo¾né cheat vypnout.
- Doporuèený postup práce s PokeManagerem: nahrát hru/aplikaci (jako snap nebo
  pøes tape emulátor). Znovu vyvolat NMI menu DEMFIRu, v browseru vybrat
  pøíslu¹ný POK soubor. Nastavit po¾adované cheaty a vrátit se zpìt do
  hry/programu. Opìtovným vyvolámím PokeManageru z NMI menu pøes klávesu 'C'
  lze mìnit stav cheatu i kdykoliv pozdìji.
- Ruèní vstup umo¾òuje zadat pøímo jednotlivé POKE. Do tohoto módu se dá dostat
  buï klávesou 'A' v PokeManageru nebo kdykoliv kdy¾ je seznam cheatù prázdný
  a je vyvolán PokeManager. Do vstupní zóny je nabídnut øetìzec, který by mìl
  pomoci v zadávání (vyu¾itím re¾imu pøepisu). Jde o tøi èísla oddìlená
  mezarami. První je èíslo 128K RAM stránky (0-7, 8 znamená ignorovat a
  neprovádìt ¾ádné stránkování), druhé èíslo je adresa (23552-65535) kam zapsat
  tøetí èíslo, tj. hodnotu POKE (0-255). Po ú¹pì¹ném odeslání se místo názvu
  cheatu objeví øetìzec, který je slo¾en následovnì:
  "stránka:adresa,hodnota (originální hodnota z RAM)".
  Lze tak ovìøit, ¾e zadané hodnoty byly interpretovány správnì. Pak je mo¾no
  s POKE pracovat jako s ka¾dým jiným cheatem.
- Omezení PokeManageru:
  - Maximální velikost POK souboru: 2048 bajtù
  - Maximální poèet cheatù nebo ruènì zadaných POKE: 24 (jedna obrazovka)
    Vzhledem k vlastnostem POK souborù mù¾e být maximální poèet cheatù ni¾¹í
    díky pamì»ové nároènosti jednotlivých cheatù (více hodnot pro jeden cheat).
  - Pokud cheat vy¾aduje zadání nìjaké hodnoty (tj. nestavový), mù¾e být zadána
    pouze první hodnota (zatím jsem se nesetkal s POK souborem kde by bylo
    mo¾no zadat více hodnot pro jeden cheat).
  - Pøi ka¾dém vyvolání PokeManageru jsou znovu kontrolovány údaje v pamìti
    a pokud aplikujete "èervený" cheat, pøi dal¹ím vyvolání u¾ z nìj bude
    "zelený", nebo» data v pamìti budou sedìt.


    Tritol

